# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/misc/pci1de4,1.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: RaspberryPi RP1 MFD PCI device

maintainers:
  - Andrea della Porta <andrea.porta@suse.com>

description:
  The RaspberryPi RP1 is a PCI multi function device containing
  peripherals ranging from Ethernet to USB controller, I2C, SPI
  and others.
  The peripherals are accessed by addressing the PCI BAR1 region.

allOf:
  - $ref: /schemas/pci/pci-ep-bus.yaml

properties:
  compatible:
    additionalItems: true
    maxItems: 3
    items:
      - const: pci1de4,1

patternProperties:
  "^pci-ep-bus@[0-2]$":
    $ref: '#/$defs/bar-bus'
    description:
      The bus on which the peripherals are attached, which is addressable
      through the BAR.

unevaluatedProperties: false

$defs:
  bar-bus:
    $ref: /schemas/pci/pci-ep-bus.yaml#/$defs/pci-ep-bus
    unevaluatedProperties: false

    properties:
      "#interrupt-cells":
        const: 2
        description:
          Specifies respectively the interrupt number and flags as defined
          in include/dt-bindings/interrupt-controller/irq.h.

      interrupt-controller: true

      interrupt-parent:
        description:
          Must be the phandle of this 'pci-ep-bus' node. It will trigger
          PCI interrupts on behalf of peripheral generated interrupts.

    patternProperties:
      "^clocks(@[0-9a-f]+)?$":
        type: object
        $ref: /schemas/clock/raspberrypi,rp1-clocks.yaml

      "^ethernet(@[0-9a-f]+)?$":
        type: object
        $ref: /schemas/net/cdns,macb.yaml

      "^pinctrl(@[0-9a-f]+)?$":
        type: object
        $ref: /schemas/pinctrl/raspberrypi,rp1-gpio.yaml

    required:
      - interrupt-parent
      - interrupt-controller

examples:
  - |
    pci {
        #address-cells = <3>;
        #size-cells = <2>;

        rp1@0,0 {
            compatible = "pci1de4,1";
            ranges = <0x01 0x00 0x00000000
                      0x82010000 0x00 0x00
                      0x00 0x400000>;
            #address-cells = <3>;
            #size-cells = <2>;

            pci_ep_bus: pci-ep-bus@1 {
                compatible = "simple-bus";
                ranges = <0xc0 0x40000000
                          0x01 0x00 0x00000000
                          0x00 0x00400000>;
                dma-ranges = <0x10 0x00000000
                              0x43000000 0x10 0x00000000
                              0x10 0x00000000>;
                #address-cells = <2>;
                #size-cells = <2>;
                interrupt-controller;
                interrupt-parent = <&pci_ep_bus>;
                #interrupt-cells = <2>;

                rp1_clocks: clocks@c040018000 {
                    compatible = "raspberrypi,rp1-clocks";
                    reg = <0xc0 0x40018000 0x0 0x10038>;
                    #clock-cells = <1>;
                    clocks = <&clk_rp1_xosc>;
                    clock-names =  "rp1-xosc";
                };
            };
        };
    };
